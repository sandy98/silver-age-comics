<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Silver Age Comics Reader</title>
        <link rel="stylesheet" type="text/css" href="stylesheets/bootstrap.min.css" />
        <style>
            ::-moz-selection {
                background: #b3d4fc;
                text-shadow: none;
            }

            ::selection {
                background: #b3d4fc;
                text-shadow: none;
            }

            html {
                padding: 30px 10px;
                font-size: 20px;
                line-height: 1.4;
                color: #737373;
                background: #f0f0f0;
                -webkit-text-size-adjust: 100%;
                -ms-text-size-adjust: 100%;
            }

            html,
            input {
                font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            }

            body {
                max-width: 1400px;
                _width: 1200px;
                padding: 30px 20px 50px;
                border: 1px solid #b3b3b3;
                border-radius: 4px;
                margin: 0 auto;
                box-shadow: 0 1px 10px #a7a7a7, inset 0 1px 0 #fff;
                background: #fcfcfc;
            }

            h1 {
                margin: 0 10px;
                font-size: 50px;
                text-align: center;
            }

            h1 span {
                color: #bbb;
            }

            h3 {
                margin: 1.5em 0 0.5em;
            }

            p {
                margin: 1em 0;
            }

            ul {
                padding: 0 0 0 40px;
                margin: 1em 0;
            }

            .container {
                max-width: 1200px;
                _width: 1200px;
                margin: 0 auto;
            }
            input::-moz-focus-inner {
                padding: 0;
                border: 0;
            }
        </style>
        <script type="text/javascript" src="javascripts/jquery.js"></script>
        <script type="text/javascript" src="javascripts/turn.min.js"></script>
        <script type="text/javascript">
          ;var parseQuery = function(query) {
            var i, len, pair;
            var obj = {};
            
            if (query.charAt(0) === '?') {
              query = query.substring(1);
            }
            var pairs = query.split('&');
            for (i = 0, len = pairs.length; i < len; i++) {
              pair = pairs[i].split('=');
              obj[pair[0]] = unescape(pair[1]);
            }
            return obj;
          };

          var showStatus = function(curr, total) {
            //$("#lblCurrent").text("Page " + curr + " / " + total);
            $('#status-label').text("Page " + (comic.page + 1) + " of " + (comic.pages + 1));
          }

          var setBusy = function(cond) {
            if (cond)
              $('html').addClass('busy');
            else
              $('html').removeClass('busy');
          };


          var showPage = function() {
            setBusy(true);
            var imgUrl = $currentImage.attr('src').replace(/page=\d+/, 'page=' + comic.page);
	    $currentImage.fadeOut();
            $currentImage.attr('src', imgUrl);
            showStatus();
	  };
          
          var onClose = function() {window.close();};
          var onPageFirst = function () {comic.page = 0; showPage();};
          var onPagePrevious = function () {if (comic.page === 0) return; comic.page -= 1; showPage();};
          var onPageNext = function () {if (comic.page === (comic.pages - 1)) return; comic.page += 1; showPage();};
          var onPageLast = function () {comic.page = comic.pages - 1; showPage();};
          
          
          $(document).ready(function() {
            $heading = $("#title-heading");
            $currentImage = $("#current-page");
            window.comic = parseQuery(location.search);
            comic.page = parseInt(comic.page);
            comic.pages = parseInt(comic.pages);
            comic.path = comic.at.split('/');
            comic.name = comic.path[comic.path.length - 1];
            comic.shortName = comic.name.replace(/\.\w{3}$/, '');
            $heading.text(comic.shortName);
            $('head title').text($('head title').text() + ' - ' + comic.shortName);

	
	    $currentImage.on("load", function() {
	      setBusy(false);
	      $currentImage.fadeIn();
	    });
	
	
	    
	    $(document.body).on("keyup", function(ev) {
    	      //alert(ev.which);
              switch (ev.which) {
                case 103:
                case 36:
                  console.log("First");
                  onPageFirst();
                  break;
                case 37:
                  console.log("Previous");
                  onPagePrevious();
                  break;
                case 39:
                  console.log("Next");
                  onPageNext();
                  break;
                case 97:
                case 35:
                  console.log("Last");
                  onPageLast();
                  break;
                case 27:
                  console.log("Close");
                  onClose();
                  break;
              }
            });

	    //$("#magazine").turn();
            $currentImage.attr('src', "page" + location.search);
            showStatus();
          });
          
        </script>
    </head>
    <body>
        <div class="container-fluid">
            <div class="page-header">
              <h1><small id="title-heading"></small></h1>
            </div>
            <hr/>
            <div id="magazine">
              <img class="img-polaroid" style="display: none;" id="current-page" src="" width="100%" height="100%" />
            </div>
        </div>
        <div class="container">
          <hr/>
          <div class="row">
            <div class="span4 offset4">
               <!--<button class="btn" id="btn-first">First Page</button>-->
               <span id="status-label" class="label label-info" style="padding: 0.5em;"></span>
            </div>
          </div>
        </div>
    </body>
</html>
